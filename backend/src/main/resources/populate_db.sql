INSERT INTO genre (id, name)
VALUES (1, 'Action'),
       (2, 'Adventure'),
       (3, 'Comedy'),
       (4, 'Crime'),
       (5, 'Drama'),
       (6, 'Fantasy'),
       (7, 'Horror'),
       (8, 'Mystery'),
       (9, 'Romance'),
       (10, 'Sci-Fi'),
       (11, 'Thriller'),
       (12, 'War');
INSERT INTO movie (id, name, description, image_url, language, minimum_age, published, rating)
VALUES (1, 'The Shawshank Redemption',
        'Two imprisoned men bond over a number of years, finding solace and eventual redemption through acts of common decency.',
        'https://m.media-amazon.com/images/I/71715eBi1sL._AC_UF894,1000_QL80_.jpg', 1, 18, 1994, 9.3),
       (2, 'The Godfather',
        'An organized crime dynasty''s aging patriarch transfers control of his clandestine empire to his reluctant son.',
        'https://m.media-amazon.com/images/M/MV5BM2MyNjYxNmUtYTAwNi00MTYxLWJmNWYtYzZlODY3ZTk3OTFlXkEyXkFqcGdeQXVyNzkwMjQ5NzM@._V1_.jpg',
        1, 18, 1972, 9.2),
       (3, 'The Dark Knight',
        'When the menace known as the Joker wreaks havoc and chaos on the people of Gotham, Batman must accept one of the greatest psychological and physical tests of his ability to fight injustice.',
        'https://www.movieposters.com/cdn/shop/products/d3401e97e249c56ed1c11a13dd02b47f_500x.jpg?v=1573652550', 1, 16,
        2008, 9),
       (4, 'Pulp Fiction',
        'The lives of two mob hitmen, a boxer, a gangster and his wife, and a pair of diner bandits intertwine in four tales of violence and redemption.',
        'https://cdn.europosters.eu/image/750/poster/pulp-fiction-one-sheet-i4435.jpg', 1, 18, 1994, 8.9),
       (5, 'The Lord of the Rings: The Fellowship of the Ring',
        'A meek Hobbit from the Shire and eight companions set out on a journey to destroy the powerful One Ring and save Middle-earth from the Dark Lord Sauron.',
        'https://m.media-amazon.com/images/I/81EBp0vOZZL.jpg', 1, 12, 2001, 8.8),
       (6, 'The Lord of the Rings: The Two Towers',
        'While Frodo and Sam edge closer to Mordor with the help of the shifty Gollum, the divided fellowship makes a stand against Sauron''s new ally, Saruman, and his hordes of Isengard.',
        'https://www.originalfilmart.com/cdn/shop/files/lord_of_the_rings_the_two_towers_2002_original_film_art_5dd21feb-10ab-41a1-84a1-4c4b082e9626.webp?v=1705516902',
        1, 12, 2002, 8.7),
       (7, 'Forrest Gump',
        'The presidencies of Kennedy and Johnson, the Vietnam War, the Watergate scandal and other historical events unfold from the perspective of an Alabama man with an IQ of 75, whose only desire is to be reunited with his childhood sweetheart.',
        'https://media.posterlounge.com/img/products/710000/705934/705934_poster.jpg', 1, 12, 1994, 8.8),
       (8, 'Inception',
        'A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O.',
        'https://www.movieposters.com/cdn/shop/products/20664117398ad7301d9a9af6d2e5aa5c_1e3ea98b-b962-4982-9f74-2e44381fc6ff_500x.jpg?v=1573618694',
        1, 13, 2010, 8.8),
       (9, 'The Matrix',
        'A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.',
        'https://www.originalfilmart.com/cdn/shop/products/matrix_1999_subway_original_film_art_3b21776a-2a9d-4656-a5b2-c4282f19046d.jpg?v=1659728398',
        1, 15, 1999, 8.7),
       (10, 'The Silence of the Lambs',
        'A young F.B.I. cadet must receive the help of an incarcerated and manipulative cannibal killer to help catch another serial killer, a madman who skins his victims.',
        'https://m.media-amazon.com/images/I/81SVDO6WcrL._AC_UF894,1000_QL80_.jpg', 1, 18, 1991, 8.6),
       (11, 'The Lion King',
        'Lion prince Simba and his father are targeted by his bitter uncle, who wants to ascend the throne himself.',
        'https://i.ebayimg.com/images/g/4QwAAOSwfZhXM4lW/s-l1200.webp', 1, 6, 1994, 8.5),
       (12, 'The Departed',
        'An undercover cop and a mole in the police attempt to identify each other while infiltrating an Irish gang in South Boston.',
        'https://m.media-amazon.com/images/I/510gCMld+uL._AC_UF894,1000_QL80_.jpg', 1, 18, 2006, 8.5),
       (13, 'Gladiator',
        'A former Roman General sets out to exact vengeance against the corrupt emperor who murdered his family and sent him into slavery.',
        'https://rukminim2.flixcart.com/image/850/1000/kyvvtzk0/poster/d/x/8/medium-gladiator-matte-finish-poster-urbanprint6311-original-imagbygdgnhbdj8z.jpeg?q=20&crop=false',
        1, 16, 2000, 8.5),
       (14, 'The Green Mile',
        'The lives of guards on Death Row are affected by one of their charges: a black man accused of child murder and rape, yet who has a mysterious gift.',
        'https://artofthemovies.co.uk/cdn/shop/products/IMG_3812-978277_a291a273-e545-4998-b0ea-dfeada12fd14.jpg?v=1656081505',
        1, 18, 1999, 8.6),
       (15, 'The Lord of the Rings: The Return of the King',
        'Gandalf and Aragorn lead the World of Men against Sauron''s army to draw his gaze from Frodo and Sam as they approach Mount Doom with the One Ring.',
        'https://cdn.europosters.eu/image/1300/posters/the-lord-of-the-rings-the-return-of-the-king-i104633.jpg', 1, 12,
        2003, 8.9),
       (16, 'Saving Private Ryan',
        'Following the Normandy Landings, a group of U.S. soldiers go behind enemy lines to retrieve a paratrooper whose brothers have been killed in action.',
        'https://m.media-amazon.com/images/M/MV5BZjhkMDM4MWItZTVjOC00ZDRhLThmYTAtM2I5NzBmNmNlMzI1XkEyXkFqcGdeQXVyNDYyMDk5MTU@._V1_.jpg',
        1, 18, 1998, 8.6),
       (17, 'Amélie',
        'Amélie is an innocent and naive girl in Paris with her own sense of justice. She decides to help those around her and, along the way, discovers love.',
        'https://artofthemovies.co.uk/cdn/shop/files/IMG_2420_1024x1024@2x.jpg?v=1685029749', 3, 13, 2001, 8.3),
       (18, 'The Intouchables',
        'After he becomes a quadriplegic from a paragliding accident, an aristocrat hires a young man from the projects to be his caregiver.',
        'https://image.tmdb.org/t/p/original/ttx4GQl0azO6NJFWj4XNZCQOY7S.jpg', 3, 13, 2011, 8.5),
       (19, 'La Haine', '24 hours in the lives of three young men in the French suburbs the day after a violent riot.',
        'https://www.movieposters.com/cdn/shop/products/lahaine.mp_500x.jpg?v=1647286118', 3, 18, 1995, 8.1),
       (20, 'A Prophet', 'A young Arab man is sent to a French prison, where he becomes a mafia kingpin.',
        'https://m.media-amazon.com/images/M/MV5BMTUyMjQ1MTY5OV5BMl5BanBnXkFtZTcwNzY5NjExMw@@._V1_.jpg', 3, 18, 2009,
        7.9),
       (21, 'Come and See',
        'After finding an old rifle, a young boy joins the Soviet resistance movement against ruthless German forces and experiences the horrors of World War II.',
        'https://cdn.posteritati.com/posters/000/000/069/458/come-and-see-md-web.jpg', 2, 18, 1985, 8.3),
       (22, 'The Return',
        'In the Russian wilderness, two brothers face a range of new, conflicting emotions when their father - a man they know only through a single photograph - resurfaces.',
        'https://image.tmdb.org/t/p/original/7V8iHBs34cPYw7ohpLqliF9x8Gv.jpg', 2, 16, 2003, 7.7),
       (23, 'Stalker',
        'In a small, unnamed country, a guide leads two men through an area known as the Zone to find a room that grants wishes.',
        'https://static.displate.com/270x380/displate/2020-07-03/0e0bf72c766359f800b8fde2494dc9a7_b6c3fc98ff5739c0d7c8e8d01f5f410d.jpg',
        2, 16, 1979, 8.1),
       (24, 'Burnt by the Sun',
        'Russia, 1936: revolutionary hero Colonel Kotov is spending an idyllic summer in his dacha with his young wife and six-year-old daughter Nadia and other assorted family and friends.',
        'https://m.media-amazon.com/images/M/MV5BOTdkZjI5ZTktZjk3ZS00NTAxLWFiYzMtMzM2ZWFiNTkwMmU5XkEyXkFqcGdeQXVyNjg3MTIwODI@._V1_.jpg',
        2, 16, 1994, 7.8),
       (25, 'Tangerines',
        'In 1992, war rages in Abkhazia, a region of Georgia. An Estonian man Ivo has stayed behind to harvest his crops of tangerines. In a bloody conflict at his door, a wounded man is left behind and Ivo is forced to take him in.',
        'https://m.media-amazon.com/images/M/MV5BMzczOGQwZmYtYjlhYS00MWNmLWJiMDktZDkzZjZiYjQ1MTQwXkEyXkFqcGdeQXVyMjExMzI0OTg@._V1_.jpg',
        0, 12, 2013, 8.2),
       (26, 'November',
        'In a Medieval Estonian village, a group of peasants use magic and folk remedies to survive the winter, and a young woman tries to get a young man to love her.',
        'https://m.media-amazon.com/images/M/MV5BNzU0NzIwMTc5M15BMl5BanBnXkFtZTgwOTI0MzI3NDM@._V1_.jpg', 0, 16, 2017,
        7.2),
       (27, 'Disco and Atomic War',
        'A documentary about how the Soviet regime in the 1970s and 1980s managed to convince most Estonians that they were living the good life in the Soviet paradise even though they knew the opposite to be true.',
        'https://cdn.posteritati.com/posters/000/000/050/320/disco-and-atomic-war-md-web.jpg', 0, 12, 2009, 7.6),
       (28, 'The Fencer',
        'Fleeing from the Russian secret police, a young Estonian fencer is forced to return to his homeland, where he becomes a physical education teacher at a local school.',
        'https://m.media-amazon.com/images/M/MV5BMTcwNzI2OTc2OV5BMl5BanBnXkFtZTgwNTE5NzkxNDE@._V1_.jpg', 0, 12, 2015,
        7.1);

INSERT INTO movie_genre (movie_id, genre_id)
VALUES (1, 5),
       (2, 4),
       (2, 5),
       (3, 1),
       (3, 4),
       (3, 5),
       (4, 4),
       (4, 5),
       (5, 1),
       (5, 2),
       (5, 5),
       (6, 1),
       (6, 2),
       (6, 5),
       (7, 5),
       (7, 9),
       (8, 1),
       (8, 2),
       (8, 10),
       (9, 1),
       (9, 10),
       (10, 4),
       (10, 5),
       (10, 11),
       (11, 2),
       (11, 5),
       (12, 4),
       (12, 5),
       (12, 11),
       (13, 1),
       (13, 2),
       (13, 5),
       (14, 4),
       (14, 5),
       (14, 6),
       (15, 1),
       (15, 2),
       (15, 5),
       (16, 5),
       (16, 12),
       (17, 3),
       (17, 9),
       (18, 3),
       (18, 5),
       (19, 4),
       (19, 5),
       (20, 4),
       (20, 5),
       (21, 5),
       (21, 12),
       (22, 5),
       (22, 8),
       (23, 5),
       (23, 10),
       (24, 5),
       (24, 7);


DO $$
    DECLARE
        movie_count INT := 28;
        session_count_per_movie INT := 5;
        ticket_count_per_session INT := 5;
        current_datetime TIMESTAMP := now();
        random_seed INT := 42; -- Seed for consistent randomness
        session_id INT;
        r_number INT;
        s_number INT;
    BEGIN
        FOR movie_id IN 1..movie_count LOOP
                FOR session_number IN 1..session_count_per_movie LOOP
                        -- Generate random start time within the day
                        current_datetime := current_datetime + INTERVAL '1 day' + INTERVAL '1 hour' * trunc(random() * 24) + INTERVAL '1 minute' * trunc(random() * 60) + INTERVAL '1 second' * trunc(random() * 60);

                        -- Insert session
                        INSERT INTO session (start_time, movie_id) VALUES (current_datetime, movie_id) RETURNING id INTO session_id;

                        -- Drop the temporary table if it exists
                        DROP TABLE IF EXISTS temp_tickets;

                        -- Generate all possible combinations of row and seat numbers for the session
                        CREATE TEMP TABLE temp_tickets (row_number INT, seat_number INT) ON COMMIT DROP;
                        INSERT INTO temp_tickets
                        SELECT DISTINCT trunc(random() * 7) + 1 AS r_num, trunc(random() * 10) + 1 AS s_num
                        FROM generate_series(1, ticket_count_per_session);

                        -- Generate tickets for the session
                        FOR i IN 1..ticket_count_per_session LOOP
                                -- Randomly select a row and seat number from the pre-generated combinations
                                SELECT row_number, seat_number FROM temp_tickets ORDER BY random() LIMIT 1 INTO r_number, s_number;

                                -- Insert the ticket
                                INSERT INTO ticket (session_id, row_number, seat_number) VALUES (session_id, r_number, s_number);

                                -- Remove the selected combination to avoid duplicates
                                DELETE FROM temp_tickets WHERE row_number = r_number AND seat_number = s_number;
                            END LOOP;
                    END LOOP;
            END LOOP;
    END $$;